title: GulpæŠ˜è…¾ä¹‹è·¯(II)
date: 2016-01-19 22:00
categories: Front-End
tags:
- Gulp
- NodeJs
description: Gulpå¸¸ç”¨æ’ä»¶ä»‹ç»ï¼šgulp-sequence,gulp-sftp,gulp.spritesmith,gulp-tinypng,gulp-replace,lazypipe,gulp-tapç­‰ç­‰;
---

å‰æ®µæ—¶é—´æŠ˜è…¾Gulpï¼Œä¸»è¦æ˜¯æœå¯»ä¸€äº›æ’ä»¶ï¼Œç»„åˆä¹‹ä»¥ä¼˜åŒ–å‰ç«¯å¼€å‘æµç¨‹ã€‚è¿™æ®µæŠ˜è…¾å†ç¨‹é™¤äº†è¾¾æˆæ‰€æ„¿å¤–ï¼Œç»™äºˆæœ€å¤§çš„æ”¶è·æ˜¯ï¼šåªè¦ä½ æƒ³å®ç°æŸåŠŸèƒ½ï¼ŒåŸºæœ¬å°±å·²æœ‰å¯¹åº”æ’ä»¶ä¾›ä½¿ç”¨ï¼›æ‰€éœ€è¦åšçš„åªæ˜¯å»å‘ç°å¥¹ï¼Œå¤–åŠ "ä¸´å¹¸"å¥¹è€Œå·²ã€‚

<!-- more -->

![GulpæŠ˜è…¾ä¹‹è·¯](http://7xoosr.com1.z0.glb.clouddn.com/gulpPage.jpg)

æ¯”å¦‚ï¼Œä¼Šå§‹è§‰å¾—ä½¿ç”¨SublimeTextçš„`SFTP`ä¸Šä¼ ä»£ç åˆ°FTPå¾ˆæ–¹ä¾¿ï¼ˆCtrl+Sï¼‰ï¼Œè€Œç”¨gulpå°±ä¼šç«Ÿä¹Ÿæœ‰å¯¹åº”æ’ä»¶`gulp-sftp`ğŸ˜ğŸ˜Šï¼Œè¿™ä¸‹æ‰“å¼€äº†ä½¿ç”¨`Gulp`çš„ä»»ç£äºŒè„‰;ä½ æƒ³è®©å„ä¸ªtaskæŒ‰é¡ºåºæ‰§è¡Œï¼Œå°±æœ‰`gulp-sequence`ä¾›ä½ æèµ·ï¼›ä½ æƒ³ä½¿ç”¨ç†ŠçŒ«å‹å›¾ï¼Œæœä¸å…¶ç„¶å°±æœ‰`gulp-tinypng`;ä½ æƒ³è®©gulpå‘½ä»¤èƒ½å¤Ÿæ¥å—ä¼ å‚ï¼Œå°±æœ‰npmçš„`yargs`æ¨¡å—åœ¨ç­‰ç€ä½ å»å® å¹¸,å¦‚æ­¤ç­‰ç­‰ï¼Œå®åœ¨å¤ªçˆ½ï¼Œæ ¹æœ¬åœä¸ä¸‹æ¥ã€‚æ­¤æ–‡å°±ä½¿ç”¨å„è·¯æ’ä»¶è·¯ä¸Šçš„äº›è®¸å¿ƒå¾—åšä¸‹è®°è½½ï¼Œä»¥ä¾›å‚è€ƒã€‚

### **[gulp-sequence](https://github.com/teambition/gulp-sequence)Run a series of gulp tasks in order.**
è¶…çº§æœ‰ç”¨çš„ç±»åº“ï¼›ä¼—æ‰€å‘¨çŸ¥jsæ˜¯å•çº¿ç¨‹çš„ï¼Œè¿ç”¨æ­¤ç±»åº“å¯ä»¥ï¼š ä¿è¯ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œè®©gulpä»»åŠ¡ï¼Œå¯ä»¥ç›¸äº’ç‹¬ç«‹ï¼Œè§£é™¤ä»»åŠ¡é—´çš„ä¾èµ–ï¼Œå¢å¼ºtaskå¤ç”¨ï¼›å¯¹äºå¤æ‚çš„æ“ä½œéå¸¸æœ‰ç”¨ï¼›å®‰è£…:
```
npm install --save-dev gulp-sequence
```

### **[gulp-sftp](https://www.npmjs.com/package/gulp-sftp)ï¼šä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°FTP**
ä¸ªäººè§‰å¾—è¿™ä¸ªæ’ä»¶å¤ªå¥½äº†ã€‚å•çº¯é‡‡ç”¨ä¼ ç»Ÿæ¨¡å¼å¼€å‘ï¼Œå¯ç”¨`xftp`,`WinScp`ç­‰å·¥å…·ä¸Šä¼ åˆ°FTPï¼›å½“ç„¶è¿™ä¸ªå¥½éº»çƒ¦ï¼›ä¸ºæ±‚æ›´æ–¹ä¾¿å¯ä»¥ä½¿ç”¨SublimeTextæ’ä»¶`SFTP`ï¼Œ`Ctrl+S`ä¹‹æ—¶å°±å¯ä»¥ä¸Šä¼ æ­¤æ–‡ä»¶åˆ°FTPï¼›ä½†ï¼Œä¸€æ—¦ç”¨SASSï¼ŒGulpç­‰å·¥å…·ï¼Œè¿™äº‹å„¿å°±å¾—é‡æ–°è€ƒé‡äº†ã€‚å¹¸å¥½æœ‰`gulp-sftp`è¿™æ ·çš„å·¥å…·ï¼Œå¯ä»¥ä¸€é”®ä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°FTPï¼›å…¶gulpfileé…ç½®ä¹Ÿå¾ˆç®€å•ï¼Œå¹¶ä¸”æŠ˜è…¾èµ·æ¥æ²¡é‡åˆ°ä»€ä¹ˆé—®é¢˜ã€‚
```js
var gulp        = require('gulp'),
    sftp        = require('gulp-sftp'),
    config      = require('./config.json');
//ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨ä»»åŠ¡
gulp.task('upload', function () {
    var workDirectory = 'xxx';
    return gulp.src( workDirectory + '/**' )
        .pipe(sftp({
            host: config.sftp.host,
            user: config.sftp.user,
            port: config.sftp.port,
            key: config.sftp.key,
            pass: config.sftp.pass,
            remotePath: config.sftp.remotePath+objectDirectoryName
        }));
});
```
ä¸ºäº†å®‰å…¨(æ¯•ç«Ÿè¿™ä¸ªéœ€è¦userNameå’Œpassword)ï¼Œå°†é‡è¦çš„é…ç½®ä¿¡æ¯ä¿å­˜åˆ°é¡¹ç›®ç›®å½•ä¸‹çš„ä¸€ä¸ªjson æ–‡ä»¶ä¸­ï¼Œåä¸º config.jsonï¼Œè¯¥æ–‡ä»¶ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š
```json
{
    "project" : "Gulp",     
    "localserver" : {
        "host" : "localhost",
        "port" : "8081"
    },
    "tinypngapi": "Tinypng API KEY(æ‰€ç”³è¯·çš„api key)",
    "sftp" : {
        "host" : "8.8.8.8",
        "user" : "username",
        "port" : "22",
        "key" : "~/.ssh/sdfsfdsf",
        "remotePath" :"/",
        "pass": "jeffjade"
    }
}
```
### **[gulp.spritesmith](https://www.npmjs.com/package/gulp.spritesmith)ç”Ÿæˆé›ªç¢§å›¾**
**gulp.spritesmith**ï¼šConvert a set of images into a spritesheet and CSS variables via gulp
è¿™ä¸ªåº“éœ€è¦é¢å¤–ä¾èµ–**spritesmith**åº“ï¼›
```npm
npm install --save-dev gulp.spritesmith  spritesmith
```
å½“ç„¶å®‰è£…çš„æ—¶å€™ææœ‰å¯èƒ½å‡ºç°é—®é¢˜ï¼ˆWinä¸‹ï¼‰ï¼›æ¯”å¦‚ï¼Œå®‰è£…çš„ç±»åº“æ— æ³•ä½¿ç”¨ï¼Œå¹¶ä¸”ä¹Ÿåˆ é™¤ï¼ˆæŒ‡å®šçš„è·¯å¾„æˆ–æ–‡ä»¶åå¤ªé•¿ï¼‰ï¼›é¢ï¼Œè¿™æ˜¯ä¸€ä¸ªè¶…è›‹ç–¼çš„é—®é¢˜ï¼›ä¹Ÿæ˜¯åœ¨å°è¯•å‡ æ¬¡åæ‰æˆåŠŸ(æ²¡é—¹æ˜ç™½å¤±è´¥å’ŒæˆåŠŸçš„åŸå› )ï¼›è‡³äºåˆ æ‰é‚£åçš„ç±»åº“ï¼Œæœ€åä¹Ÿæ˜¯é‡‡ç”¨å°†éƒ¨åˆ†`å‰ªåˆ‡å‡ºå»`æˆ–è€…æ‰‹åŠ¨renameè‡´ä½¿è·¯å¾„å˜çŸ­äº›æ‰å¾—ä»¥å¹²æ‰å®ƒã€ç”¨del rdå‘½ä»¤éƒ½ä¸è¶³ä»¥åˆ é™¤ä¹‹,æˆ‘å±®è‰¸èŠ”èŒ»ï¼Œé†‰äº†~ã€‘ï¼›
>del : æŒ‡å®šçš„è·¯å¾„æˆ–æ–‡ä»¶åå¤ªé•¿ï¼Œæˆ–è€…ä¸¤è€…éƒ½å¤ªé•¿ã€‚å®Œå…¨é™å®šæ–‡ä»¶åå¿…é¡»å°‘äº 260 ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”ç›®å½•åå¿…é¡»å°‘äº 248 ä¸ªå­—ç¬¦ã€‚

>[Y] æ˜¯(Y)  [A] å…¨æ˜¯(A)  [N] å¦(N)  [L] å…¨å¦(L)  [S] æŒ‚èµ·(S)  [?] å¸®åŠ© (é»˜è®¤å€¼ä¸ºâ€œYâ€): A
rd : æŒ‡å®šçš„è·¯å¾„æˆ–æ–‡ä»¶åå¤ªé•¿ï¼Œæˆ–è€…ä¸¤è€…éƒ½å¤ªé•¿ã€‚å®Œå…¨é™å®šæ–‡ä»¶åå¿…é¡»å°‘äº 260 ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”ç›®å½•åå¿…é¡»å°‘äº 248 ä¸ªå­—ç¬¦ã€‚

gulpfileé…ç½®å¦‚ä¸‹å³å¯ï¼š
```js
var gulp        = require('gulp'),
    spritesmith = require('gulp.spritesmith');
//è¿ç”¨gulpä¸€é”®ç”Ÿæˆ[é›ªç¢§å›¾]
gulp.task('sprite', function(){
    var workDirectory = 'xxx', outPut = 'yyy';
    return gulp.src( workDirectory+'/images/*.png' )
    .pipe( spritesmith({
        imgName:'sprite.png',
        cssName:'sprite.css'
    }) )
    .pipe( gulp.dest(outPut+'/images') );
});
```

### **[gulp-tinypng](https://www.npmjs.com/package/gulp-tinypng)ä½¿ç”¨ç†ŠçŒ«å‹å›¾**
**gulp-tinypng**ï¼šgulp plugin to compress png images using tinypng api
```js
var gulp        = require('gulp'),
    tinypng     = require('gulp-tinypng');
//å‹ç¼©å›¾ç‰‡ - tinypng
gulp.task('tinypng', function () {
    var workDirectory = 'xxx', outPut = 'yyy';
    gulp.src( workDirectory+'/images/*.{png,jpg,jpeg}')
        .pipe(tinypng(config.tinypngapi))
        .pipe(gulp.dest( outPut+'/images' ));
});
```
è¿™é‡ŒæŠ˜è…¾èµ·æ¥æ²¡é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼›å½“ç„¶è¿™é‡Œéœ€è¦é…ç½®`API Key`;éœ€è¦å»tinypngå¼€å‘è€…[https://tinypng.com/developers](https://tinypng.com/developers),è·å¾—ä¸€ä¸ªåˆæ³•çš„API Keyï¼›å¦åˆ™è¿è¡Œä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š
>gulp-tinypng - Credentials are invalid

### **[gulp-replace](https://www.npmjs.com/package/gulp-replace):A string replace plugin for gulp**
```
npm install --save-dev gulp-replace
```
åœ¨é¡¹ç›®ä¸­è¿™ä¸ªæ’ä»¶è¿˜æ˜¯æŒºæœ‰ç”¨çš„ï¼Œå¯ä»¥æ‰¹é‡æ›¿æ¢å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ”¯æŒä½¿ç”¨æ­£åˆ™æ›¿æ¢ï¼›ä½¿ç”¨ç¤ºä¾‹ï¼š
```js
var replace = require('gulp-replace');

gulp.task('templates', function(){
  gulp.src(['file.txt'])
    .pipe(replace(/foo(.{3})/g, '$1foo'))
    .pipe(gulp.dest('build/file.txt'));
});
```

### **[gulp-tap](https://www.npmjs.com/package/gulp-tap):Easiest way to tap into a pipeline**
çœ‹å…¶æè¿°â€œæœ€ç®€å•æ‰“é€šç®¡é“çš„æ–¹æ³•â€ï¼Œå®˜æ–¹ç»™å‡ºçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š
```js
gulp.src("src/**/*.{coffee,js}")
    .pipe(tap(function(file, t) {
        if (path.extname(file.path) === '.coffee') {
            return t.through(coffee, []);
        }
    }))
    .pipe(gulp.dest('build'));
```
è¿™ä¸ªæ’ä»¶å¾ˆæœ‰ä½œç”¨ï¼Œå®ƒå¯ä»¥ç”¨æ¥éå†`gulp.src()`æŒ‡å®šçš„é‚£äº›æ–‡ä»¶ï¼›åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä»¥åŠnpmä¸‹è‡ªå¸¦çš„`path`æ’ä»¶ï¼Œå³å¯è·å–åˆ°æ¯ä¸ªæ–‡ä»¶çš„æ–‡ä»¶åï¼›åœ¨ç‰¹å®šåœºæ™¯éœ€æ±‚é‡Œï¼Œå®ƒå¸®äº†æˆ‘å¾ˆå¤§å¿™ã€‚
```js
var gulp = require('gulp');
var path = require('path');
var tap = require('gulp-tap');

gulp.task('examples', function() {
return gulp.src('./examples/*.html')
    .pipe(tap(function (file,t) {
        console.log(path.basename(file.path));
        // Do something with the file name
    }))
    .pipe(gulp.dest('./build'));
});
```
---

### **[lazypipe](https://www.npmjs.com/package/lazypipe)**:Use to create an immutable, lazily initialized pipeline from a series of streams.
```
npm install --save-dev lazypipe
```
å¦‚æœä½ åœ¨å¤šä¸ªä»»åŠ¡ä¸­ä½¿ç”¨äº†ç›¸åŒçš„æ’ä»¶ï¼Œä½ å¯èƒ½å‘ç°ä½ å¾ˆæƒ³æŠŠè¿™äº›ä¸œè¥¿ä»¥`DRYåŸåˆ™`[^footnote]å»å¤„ç†ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥åˆ›å»ºä¸€äº›å·¥å‚æ¥æŠŠä½ ç»å¸¸ä½¿ç”¨çš„`stream`é“¾åˆ†ç¦»å‡ºæ¥ã€‚è¿™å¯ä»¥ä½¿ç”¨`lazypipe`æ¥å®Œæˆè¿™ä»¶äº‹ï¼›å‚è€ƒæ–‡ç« ï¼š[é€šè¿‡ stream å·¥å‚æ¥å…±äº« stream](http://www.gulpjs.com.cn/docs/recipes/sharing-streams-with-stream-factories/)ã€‚
```js
var gulp = require('gulp');
var uglify = require('gulp-uglify');
var coffee = require('gulp-coffee');
var jshint = require('gulp-jshint');
var stylish = require('jshint-stylish');
var lazypipe = require('lazypipe');

// èµ‹ç»™ lazypipe
var jsTransform = lazypipe()
  .pipe(jshint)
  .pipe(jshint.reporter, stylish)
  .pipe(uglify);

gulp.task('bootstrap', function() {
  return gulp.src('bootstrap/js/*.js')
    .pipe(jsTransform())
    .pipe(gulp.dest('public/bootstrap'));
});

gulp.task('coffee', function() {
  return gulp.src('lib/js/*.coffee')
    .pipe(coffee())
    .pipe(jsTransform())
    .pipe(gulp.dest('public/js'));
});
```
ä½ å¯ä»¥çœ‹åˆ°ï¼Œå¤šä¸ªä»»åŠ¡ä¸­éƒ½åœ¨ä½¿ç”¨çš„ JavaScript ç®¡é“ï¼ˆJSHint + Uglifyï¼‰åˆ†ç¦»åˆ°äº†ä¸€ä¸ªå·¥å‚ã€‚å·¥å‚å¯ä»¥åœ¨ä»»æ„å¤šçš„ä»»åŠ¡ä¸­é‡ç”¨ã€‚ä½ ä¹Ÿå¯ä»¥åµŒå¥—è¿™äº›å·¥å‚ï¼Œæˆ–è€…æŠŠå®ƒä»¬è¿æ¥èµ·æ¥ï¼Œå·²è¾¾åˆ°æ›´å¥½çš„æ•ˆæœã€‚åˆ†ç¦»å‡ºæ¯ä¸ªå…±äº«çš„ç®¡é“ï¼Œä¹Ÿå¯ä»¥è®©ä½ èƒ½å¤Ÿé›†ä¸­åœ°ç®¡ç†ï¼Œå½“ä½ çš„å·¥ä½œæµç¨‹æ›´æ”¹åï¼Œä½ åªéœ€è¦ä¿®æ”¹ä¸€ä¸ªåœ°æ–¹å³å¯ã€‚

---

æ­¤å¤–è¿˜æœ‰ **[yargs](https://github.com/bcoe/yargs)**ï¼Œ**[path](https://www.npmjs.com/package/path)**ï¼Œ[gulp-changed](https://www.npmjs.com/package/gulp-changed) ç­‰ç­‰è¯¸å¤šæ¨¡å—ï¼Œå›ä¹‹æ‰€éœ€ï¼Œå¯è°“åº”æœ‰å°½æœ‰--åªè¦ä½ æ„¿æ„å»æŠ˜è…¾ï¼›å®åœ¨æ²¡æœ‰è‡ªå·±å†™ä¸€ä¸ªä¹Ÿå¹¶ä¸æ˜¯ä»€ä¹ˆå¤§éš¾äº‹ã€‚æŠ˜è…¾ï¼Œåªä¸ºè®©äº‹ç‰©å˜å¾—æ›´ç®€æ´ã€‚Not Fucking Excuse ,Just Do Itã€‚

[^footnote]:DRYæ˜¯â€œDon't Repeat Yourselfâ€çš„ç¼©å†™ã€‚æ„æ€æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªè®¾è®¡é‡Œï¼Œå¯¹äºä»»ä½•ä¸œè¥¿ï¼Œéƒ½åº”è¯¥æœ‰ä¸”åªæœ‰ä¸€ä¸ªè¡¨ç¤ºï¼Œå…¶å®ƒçš„åœ°æ–¹éƒ½åº”è¯¥å¼•ç”¨è¿™ä¸€å¤„ã€‚è¿™æ ·éœ€è¦æ”¹åŠ¨çš„æ—¶å€™ï¼Œåªéœ€è°ƒæ•´è¿™ä¸€å¤„ï¼Œæ‰€æœ‰çš„åœ°æ–¹å°±éƒ½å˜æ›´è¿‡æ¥äº†ã€‚
